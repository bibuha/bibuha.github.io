<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RICHBOT v2.0 - Iklan & Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script> <!-- WebApp Telegram -->
    <script src="https://js.onclckvd.com/in-stream-ad-admanager/tma.js"></script> <!-- TMA Ads -->
    <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; background-color: #f4f4f4; }
        .container { max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        h2 { color: #333; }
        button { padding: 12px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; margin-top: 10px; }
        #playAdBtn { background: #007bff; color: white; }
        #playAdBtn:disabled { background: #ccc; cursor: not-allowed; }
        .debug { margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #fffbe6; text-align: left; display: inline-block; width: 100%; border-radius: 5px; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h2>RICHBOT v2.0</h2>
        <p><strong>Nama:</strong> <span id="nama">...</span></p>
        <p><strong>Username:</strong> <span id="username">...</span></p>
        <p><strong>ID Telegram:</strong> <span id="telegramID">...</span></p>
        <p><strong>Saldo Anda:</strong> <span id="saldo">0</span> Rp</p>

        <button id="playAdBtn" disabled>Muat Iklan...</button>

        <div class="debug">
            <strong>Log Debugging:</strong>
            <p id="log">Menunggu iklan dimuat...</p>
        </div>
    </div>

    <script>
        let adReady = false;  // Status apakah iklan siap
        let spotID = "Rewarded_video— TMA Rewarded video #1"; // Sesuaikan dengan Spot ID Anda
        let saldo = 0;  // Simpan saldo pengguna (bisa diambil dari localStorage atau database)

        function updateLog(message, isError = false) {
            let logElem = document.getElementById("log");
            logElem.innerHTML = message;
            logElem.className = isError ? "error" : "";
        }

        // **1. Inisialisasi WebApp Telegram & Ambil Data Pengguna**
        let tg = window.Telegram.WebApp;
        tg.expand();  // Mode layar penuh
        let user = tg.initDataUnsafe?.user;

        if (user) {
            document.getElementById("nama").textContent = user.first_name || "Tidak diketahui";
            document.getElementById("username").textContent = "@" + (user.username || "Tidak ada");
            document.getElementById("telegramID").textContent = user.id;
        } else {
            updateLog("❌ Gagal mengambil data Telegram.", true);
        }

        // **2. Inisialisasi Iklan TMA**
        window.initCdTma?.({ id: 6063610 })
            .then(show => {
                window.show = show;
                document.getElementById("playAdBtn").innerText = "Tonton Iklan";
                document.getElementById("playAdBtn").disabled = false;
                adReady = true;
                updateLog("✅ Iklan siap ditampilkan.");
            })
            .catch(e => {
                console.error("Gagal memuat iklan:", e);
                updateLog("❌ Gagal memuat iklan: " + e.message, true);
            });

        // **3. Event Klik untuk Memutar Iklan**
        document.getElementById("playAdBtn").addEventListener("click", () => {
            if (!adReady) return;

            document.getElementById("playAdBtn").disabled = true; // Cegah spam klik
            updateLog("⏳ Memutar iklan...");

            window.show?.()
                .then(() => {
                    console.log("✅ Iklan berhasil diputar!");
                    saldo += 14;  // Tambah saldo setelah iklan berhasil
                    document.getElementById("saldo").textContent = saldo;
                    updateLog("✅ Iklan selesai! Saldo bertambah.");
                })
                .catch(e => {
                    console.error("Error saat menampilkan iklan:", e);
                    updateLog("❌ Gagal menampilkan iklan: " + e.message, true);
                })
                .finally(() => {
                    setTimeout(() => {
                        document.getElementById("playAdBtn").disabled = false; // Aktifkan lagi tombol setelah delay
                    }, 2000);
                });
        });
    window.TelegramAdsController = new TelegramAdsController();
            window.TelegramAdsController.initialize({
              pubId: "963391",
              appId: "1707",
            });
    </script>

</body>
</html>