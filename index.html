<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rich Bot v4 - Tonton Iklan</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>  
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(120deg, #1e1e1e, #333);
            color: #fff;
            text-align: center;
            padding: 20px;
        }
        .info-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 10px auto;
            max-width: 400px;
        }
        #watchAdButton {
            background: #ffcc00;
            color: #000;
            font-size: 18px;
            padding: 12px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
        }
        #watchAdButton:disabled {
            background: gray;
            cursor: not-allowed;
        }
        #balance, #adsWatched {
            font-size: 24px;
            font-weight: bold;
        }
        #notification {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 12px;
            border-radius: 5px;
            display: none;
            color: #fff;
            font-size: 16px;
            z-index: 1000;
        }
    </style>
</head>
<body>

    <h1>ðŸŽ¥ Rich Bot v4 ðŸŽ¥</h1>

    <div class="info-box">
        <p>ðŸ‘¤ Nama: <span id="name">-</span></p>
        <p>ðŸ“› Username: <span id="username">-</span></p>
        <p>ðŸ†” ID Telegram: <span id="userId">-</span></p>
    </div>

    <p>ðŸ’° Saldo Anda: Rp <span id="balance">0</span></p>
    <p>ðŸŽ¯ Jumlah Tontonan Hari Ini: <span id="adsWatched">0</span> / 20</p>
    
    <button id="watchAdButton" onclick="tontonIklan()">ðŸŽ¥ Tonton Iklan Rp.10 ðŸŽ¥</button>
    
    <div id="notification"></div>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
            initWebApp();
            resetDailyLimit();
              // Pastikan Telegram Ads tersedia sebelum digunakan
    setTimeout(() => {
        if (typeof window.TelegramAdsController !== "undefined") {
            window.TelegramAdsController.initialize({
                pubId: "963391",
                appId: "1707"
            });
        } else {
            console.error("TelegramAdsController tidak tersedia.");
        }
    }, 500);
            document.getElementById("balance").innerText = getFromStorage(PREFIX + "balance") || 0;
            let adsWatched = getFromStorage(PREFIX + "adsWatched") || 0;
document.getElementById("adsWatched").innerText = adsWatched;
if (adsWatched >= dailyLimit) {
    document.getElementById("watchAdButton").disabled = true;
}
        });
    
        const PREFIX = "v4_";
        let dailyLimit = 20;
        let rewardPerAd = 10;
        let countdownTime = 60; // 60 detik hitung mundur
        let countdownInterval;

        function saveToStorage(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (error) {
                console.error("Gagal menyimpan ke localStorage:", error);
            }
        }

        function getFromStorage(key) {
            let data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        }
        function initWebApp() {
            if (window.Telegram.WebApp) {
                let tg = window.Telegram.WebApp;
                tg.expand();
                tg.MainButton.hide();
                console.log("Telegram Mini App berhasil diinisialisasi!");

                if (tg.initDataUnsafe.user) {
                    let user = tg.initDataUnsafe.user;
                    document.getElementById("name").innerText = user.first_name || "-";
                    document.getElementById("username").innerText = user.username ? "@" + user.username : "-";
                    document.getElementById("userId").innerText = user.id || "-";
                }
            }
        }

        function resetDailyLimit() {
    let now = new Date();
    let currentDate = now.toDateString();
    let lastReset = getFromStorage(PREFIX + "lastReset");

    if (lastReset !== currentDate) {
        saveToStorage(PREFIX + "adsWatched", 0);
        let saldo = getFromStorage(PREFIX + "balance") || 0;
        saveToStorage(PREFIX + "balance", saldo); // Saldo tidak di-reset
        saveToStorage(PREFIX + "lastReset", currentDate);

        document.getElementById("adsWatched").innerText = 0;
        document.getElementById("watchAdButton").disabled = false;
        document.getElementById("watchAdButton").innerText = "ðŸŽ¥ Tonton Iklan Rp.10 ðŸŽ¥";
    }
}

        function tontonIklan() {
    resetDailyLimit();
            adsWatched = getFromStorage(PREFIX + "adsWatched") || 0;

    if (adsWatched >= dailyLimit) {
        showNotification("ðŸš« Anda sudah mencapai batas tontonan hari ini.");
        return;
    }

    if (!navigator.onLine) {
        showNotification("âŒ Koneksi internet terputus!");
        return;
    }

    let adController = window.TelegramAdsController;
    if (!adController) {
        showNotification("âŒ Iklan tidak tersedia.");
        return;
    }
            
      if (typeof window.TelegramAdsController === "undefined") {
    showNotification("âŒ Iklan tidak tersedia.");
    return;
    }

    let button = document.getElementById("watchAdButton");
    button.disabled = true; // Blokir tombol saat iklan sedang berjalan
    button.innerText = "ðŸ”„ Memuat iklan...";

    adController.showAd({
        onComplete: () => {
            console.log("âœ… Iklan selesai, menambahkan saldo dan jumlah tontonan");
            adsWatched++;
            saveToStorage(PREFIX + "adsWatched", adsWatched);
            updateBalance(rewardPerAd);
            showNotification(`âœ… Iklan selesai! Anda mendapat Rp.${rewardPerAd}`);
            document.getElementById("adsWatched").innerText = adsWatched;

            if (adsWatched >= dailyLimit) {
                button.disabled = true;
                button.innerText = "ðŸŽ¯ Batas Tercapai";
            } else {
                startCountdown();
            }
        },
        onError: () => {
            console.log("âŒ Iklan gagal ditampilkan");
            showNotification("âŒ Iklan gagal ditampilkan.");
            button.disabled = false;
            button.innerText = "ðŸŽ¥ Tonton Iklan Rp.10 ðŸŽ¥";
        },
        onClose: () => {
            console.log("âš ï¸ Iklan ditutup sebelum selesai, tidak ada reward.");
            showNotification("âš ï¸ Iklan ditutup sebelum selesai. Tidak ada reward.");
            button.disabled = false;
            button.innerText = "ðŸŽ¥ Tonton Iklan Rp.10 ðŸŽ¥";
        }
    });
}

        function updateBalance(amount) {
            let currentBalance = getFromStorage(PREFIX + "balance") || 0;
            let newBalance = currentBalance + amount;
            saveToStorage(PREFIX + "balance", newBalance);
            document.getElementById("balance").innerText = newBalance;
        }

        function startCountdown() {
            let button = document.getElementById("watchAdButton");
            button.disabled = true;
            let timeLeft = countdownTime;

            countdownInterval = setInterval(() => {
                if (timeLeft > 0) {
                    button.innerText = `â³ Tunggu ${timeLeft}s`;
                    timeLeft--;
                } else {
                    clearInterval(countdownInterval);
                    button.disabled = false;
                    button.innerText = "ðŸŽ¥ Tonton Iklan Rp.10 ðŸŽ¥";
                }
            }, 1000);
        }

        function showNotification(message) {
            const notification = document.getElementById("notification");
            notification.innerHTML = message;
            notification.style.display = "block";
            setTimeout(() => { notification.style.display = "none"; }, 3000);
        }

        function saveToStorage(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        }

        function getFromStorage(key) {
            let data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        }

        
   
    </script>

</body>
</html>