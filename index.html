<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rich Bot - Telegram & RichAds</title>

    <!-- Telegram WebApp & RichAds SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
    <script src='//whephiwums.com/sdk.js' data-zone='9075309' data-sdk='show_9075309'></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to right, #4e54c8, #8f94fb);
            color: #fff;
            text-align: center;
            padding: 20px;
            margin: 0;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .button-container {
            margin: 20px 0;
        }

        .ad-button {
            padding: 15px 30px;
            font-size: 18px;
            color: white;
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;            
            display: block;
            margin: 10px auto;
        }

        .ad-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.5);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        #notification {
            margin-top: 20px;
            padding: 10px;
            display: none;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
    @keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

.fade-out {
    animation: fadeOut 1s forwards;
}
    .popup {
    position: fixed;
    top: 30%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #4CAF50, #2E8B57);
    color: white;
    padding: 20px 30px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    z-index: 9999;
    text-align: center;
    display: none;
}

.popup button {
    background: #ffffff;
    color: #2E8B57;
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 10px;
}

        #userInfo {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        #bannerAd {
    margin: 30px auto; /* Memberikan jarak 30px di bagian atas dan bawah, serta memusatkan banner secara horizontal */
    width: 100%; /* Membuat lebar banner sebesar 100% dari lebar parent container */
    height: 100px; /* Menentukan tinggi banner menjadi 250px */
    background: rgba(0, 0, 0, 0.2); /* Memberikan warna latar belakang hitam dengan transparansi 20% */
    border-radius: 10px; /* Membuat sudut banner menjadi membulat dengan radius 10px */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); /* Memberikan efek bayangan di sekitar banner (X: 0, Y: 4px, Blur: 8px, Transparansi: 40%) */
    display: flex; /* Mengatur banner menggunakan flexbox agar mudah dalam pengaturan isi (content) */
    align-items: center; /* Memusatkan konten secara vertikal di tengah banner */
    justify-content: center; /* Memusatkan konten secara horizontal di tengah banner */
}
    
     #withdrawForm, #historySection {
            display: none;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-top: 20px;
        }

        input, button {
            margin: 10px;
            padding: 10px;
            border-radius: 5px;
        }
    /* Gaya Notifikasi booster*/
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #4CAF50;
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    z-index: 9999;
}
    /* Gaya Tombol booster */
.ad-button {
    padding: 10px 20px;
    font-size: 18px;
    background: #ff4757;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

.ad-button:disabled {
    background: #888888;
    cursor: not-allowed;
}
    </style>
</head>

<body>

    <h1>‚ú® Rich Bot v4.0 ‚ú®</h1>
    

    <!-- Banner Ad (Embedded) -->
    <div id="bannerAd">Iklan sedang dimuat...</div>

    <div id="userInfo">Memuat data Telegram...</div>
    <div id="notification"></div>
     <p><strong>üí∞ Saldo:</strong> Rp.<span id="balance">0</span></p>
    <p><strong>üé• Tontonan:</strong> <span id="views">0</span>/35</p>
    <p><strong>üöÄ Booster:</strong> <span id="boosters">0</span>/6</p>
</div>
<div id="notification"></div>
<div id="welcomePopup" class="popup">
    ‚úÖ Selamat datang kembali di Rich Bot!
    <button onclick="closePopup()">Oke</button>
</div>

    <!-- Tombol Iklan Monetag (Tombol Baru di Atas) -->
    <div class="button-container">
        <button class="ad-button" id="monetagButton" onclick="tontonIklan()">üé•Tonton Iklan Rp.10üé•</button>
    </div>

    <!-- Tombol Iklan Telegram (Tombol Lama) -->
<p>Booster: <span id="boosterCount">0</span> | Iklan: <span id="boosterAds">0/21</span></p>

    <div class="button-container">
        <button class="ad-button" id="rewardButton">üöÄboosterüöÄ</button>
    </div>


<button class="ad-button" onclick="toggleWithdrawForm()">üí∏ Cairkan Saldo</button>
<!-- Form Penarikan -->
    <div id="withdrawForm">
        <h3>üí∏ Form Penarikan</h3>
        <input type="text" id="namaDANA" placeholder="Nama DANA">
        <input type="text" id="noDANA" placeholder="Nomor DANA (10-13 digit)">
        <input type="number" id="amount" placeholder="Jumlah (Min Rp.1000, kelipatan Rp.1000)">
        <button onclick="withdraw()">‚úÖ Tarik Saldo</button>
    </div>
        <button class="ad-button" onclick="toggleHistory()">üìú Riwayat Penarikan</button>
    </div>

    

    <!-- Riwayat Penarikan -->
    <div id="historySection">
        <h3>üìú Riwayat Penarikan</h3>
        <div id="historyList">Belum ada riwayat.</div>
    <!-- Notifikasi -->
    

    <script>
               
// Jalankan Saat Halaman Dimuat
window.addEventListener('DOMContentLoaded', async () => {
    console.log('Isi localStorage:', localStorage);

    initTelegramWebApp();
    validateUser();   
    showPopup();
    resetDaily();
    loadUserData();
    showBanner();
    resetDailyBooster();
    updateBalanceDisplay();
    updateBoosterUI(getFromStorage('boostersAds'), getFromStorage('boosterAds'));
    updateBoosterCount(getFromStorage('boosters') || 0);

    // Pastikan event listener tidak ditambahkan berulang
    const boosterButton = document.getElementById('rewardButton');
    if (!boosterButton.hasListener) {
        boosterButton.addEventListener('click', showTelegramAd);
        boosterButton.hasListener = true; // Tandai bahwa listener sudah ditambahkan
    }

    const balance = getFromStorage('balance') || 0;
    const adsWatched = getFromStorage('adsWatched') || 0;
    document.getElementById('boosters').innerText = `${getFromStorage('boostersAds') || 0}/21`;
});
    
        
        // Fungsi Penyimpanan dengan Prefix v4_
function saveToStorage(key, value) {
    localStorage.setItem(`v4_${key}`, JSON.stringify(value));
    console.log(`‚úÖ Disimpan: v4_${key} =`, value);
}

function getFromStorage(key) {
    const data = localStorage.getItem(`v4_${key}`);
    console.log(`üì§ Diambil: v4_${key} =`, data);
    return data ? JSON.parse(data) : 0;  // Pastikan default 0 jika tidak ada data
}
                // Reset otomatis pukul 00:00 (dengan validasi waktu)
function resetDaily() {
    const lastReset = getFromStorage('lastReset');
    const today = new Date().toISOString().split('T')[0]; // Format YYYY-MM-DD

    if (lastReset !== today) {
        saveToStorage('adsWatched', 0);  // Reset jumlah iklan Monetag
        saveToStorage('boosters', 0);    // Reset booster Telegram
        saveToStorage('boosterAds', 0);  // Reset batas booster
        saveToStorage('lastReset', today); // Perbarui tanggal reset
        console.log('üîÑ Data di-reset otomatis pada:', today);
    }
}
       // Inisialisasi Telegram WebApp
let telegramUser = {};

function initTelegramWebApp() {
    if (window.Telegram && Telegram.WebApp) {
        try {
            Telegram.WebApp.ready();
            const user = Telegram.WebApp.initDataUnsafe?.user;

            if (user) {
                telegramUser = user;
                saveToStorage('user', user); // Simpan dengan prefix v4_
                displayUserInfo(user);
                console.log("‚úÖ Data Pengguna:", user);
            } else {
                showNotification("‚ùå Gagal memuat data Telegram.");
            }
        } catch (error) {
            console.error("‚ùå Error mengambil data Telegram:", error);
            showNotification("‚ùå Terjadi kesalahan saat memuat data.");
        }
    } else {
        showNotification("‚ùå Telegram WebApp tidak tersedia.");
    }
}

// Tampilkan Info Pengguna Telegram
function displayUserInfo(user) {
    const userInfo = document.getElementById('userInfo');
    userInfo.innerHTML = `
        <p><strong>üë§ Nama:</strong> ${user.first_name || 'Tidak ada'}</p>
        <p><strong>üìõ Username:</strong> ${user.username || 'Tidak ada'}</p>
        <p><strong>üÜî ID:</strong> ${user.id || 'Tidak ada'}</p>
    `;
}

// Fungsi Membuat Fingerprint Unik (User Agent + Platform + Resolusi + Bahasa + CPU)
function getDeviceFingerprint() {
    return `${navigator.userAgent}-${navigator.platform}-${screen.width}x${screen.height}-${navigator.language}-${navigator.hardwareConcurrency}`;
}

// Cek Apakah Diakses dari Telegram WebApp
function isTelegramWebApp() {
    return window.Telegram && Telegram.WebApp && Telegram.WebApp.initData;
}

// Bersihkan Data Validasi Lama (>24 jam)
function cleanOldData() {
    const registeredData = JSON.parse(localStorage.getItem('registeredData')) || [];
    const now = Date.now();
    const expiredTime = 24 * 60 * 60 * 1000; // 24 jam

    const cleanedData = registeredData.filter(entry => now - entry.timestamp < expiredTime);
    localStorage.setItem('registeredData', JSON.stringify(cleanedData));
}

// Validasi Pengguna Telegram, IP, dan Device
async function validateUser() {
    try {
        // Bersihkan data lama
        cleanOldData();

        // Pastikan Hanya Bisa Diakses dari Telegram
        if (!isTelegramWebApp()) {
            alert('üö´ Hanya bisa diakses melalui Telegram!');
            document.body.innerHTML = '<h2>üö´ Akses dibatasi, buka di Telegram!</h2>';
            return;
        }

        const user = Telegram.WebApp.initDataUnsafe?.user;
        if (!user) {
            alert('üö´ Bot terdeteksi, akses diblokir!');
            document.body.innerHTML = '<h2>üö´ Bot Tidak Diizinkan</h2>';
            return;
        }
        const userId = user.id;

        // Ambil IP Publik (Fallback ke 127.0.0.1 jika gagal)
        const ipResponse = await fetch('https://api.ipify.org?format=json').catch(() => null);
        const ip = ipResponse ? (await ipResponse.json()).ip : '127.0.0.1';

        // Ambil Fingerprint Perangkat
        const deviceFingerprint = getDeviceFingerprint();
        console.log(`üì≤ Fingerprint: ${deviceFingerprint}`);

        // Ambil Data Validasi Sebelumnya
        const registeredData = JSON.parse(localStorage.getItem('registeredData')) || [];
        const sessionData = JSON.parse(localStorage.getItem('sessionData')) || null;

        // Jika Ada di sessionStorage (Cegah Refresh atau Restart)
        if (sessionData && sessionData.userId === userId && sessionData.device === deviceFingerprint) {            
            console.log('‚úÖ Sesi aktif, validasi lewat.');
            return;
        }

        // Validasi Ketat: Cegah Akun, Perangkat, atau IP Ganda
        const isUserIdUsed = registeredData.some(entry => entry.userId === userId);
        const isDeviceUsed = registeredData.some(entry => entry.device === deviceFingerprint);
        const devicesPerIP = registeredData.filter(entry => entry.ip === ip).length;

        if (isUserIdUsed) {
            // Hapus perangkat lama jika akun digunakan di perangkat baru
            const updatedData = registeredData.filter(entry => entry.userId !== userId);
            localStorage.setItem('registeredData', JSON.stringify(updatedData));
            console.log('üîÑ Perangkat lama dihapus, akses diperbarui.');
        } else if (isDeviceUsed) {
            alert('üö´ Akses ditolak: Perangkat ini sudah digunakan dengan akun lain.');
            document.body.innerHTML = '<h2>üö´ Perangkat Tidak Diizinkan</h2>';
            return;
        } else if (devicesPerIP >= 1) {
            alert('üö´ Akses dibatasi: Hanya 1 perangkat yang diizinkan di jaringan ini.');
            document.body.innerHTML = '<h2>üö´ Batas Perangkat Tercapai</h2>';
            return;
        }

        // Simpan Data Baru (ID + IP + Device)
        const newEntry = { userId, ip, device: deviceFingerprint, timestamp: Date.now() };
        registeredData.push(newEntry);
        localStorage.setItem('registeredData', JSON.stringify(registeredData));

        // Simpan di sessionStorage (Agar Bertahan di Sesi Ini)
        localStorage.setItem('sessionData', JSON.stringify({ userId, ip, device: deviceFingerprint }));

        alert('‚úÖ Selamat datang di Rich Bot!');
    } catch (error) {
        console.error('‚ùå Error validasi pengguna:', error);
        alert('‚ùå Gagal memverifikasi pengguna.');
    }
}
// Jalankan Validasi Saat Halaman Dimuat
validateUser();
        function showPopup() {
        document.getElementById('welcomePopup').style.display = 'block';
    }

    function closePopup() {
        document.getElementById('welcomePopup').style.display = 'none';
    }



// Inisialisasi Telegram Ads
window.TelegramAdsController = new TelegramAdsController();
window.TelegramAdsController.initialize({
    pubId: "963391",
    appId: "1707"
});
        // Menampilkan Embedded Banner
function showBanner() {
    const bannerContainer = document.getElementById('bannerAd');

    if (window.TelegramAdsController) {
        window.TelegramAdsController.showBanner(bannerContainer, {
            onLoad: function() {
                bannerContainer.innerHTML = ''; // Bersihkan teks loading
            },
            onError: function() {
                bannerContainer.innerHTML = '‚ùå Gagal memuat banner.';
            }
        });
    } else {
        bannerContainer.innerHTML = '‚ùå Banner tidak tersedia.';
    }
}
       
// Maksimal tontonan iklan Monetag per hari
const MAX_ADS_PER_DAY = 35;

// Fungsi untuk menonton iklan Monetag
function tontonIklan() {
    let adsWatched = getFromStorage('adsWatched') || 0;

    // Validasi batas harian
    if (adsWatched >= MAX_ADS_PER_DAY) {
        showNotification('üö´ Batas tonton iklan harian tercapai.');
        const button = document.getElementById('monetagButton');
        button.innerText = 'üö´ Batas Tercapai';
        button.disabled = true; // Nonaktifkan tombol jika batas tercapai
        return;
    }

    // Tampilkan iklan Monetag jika tersedia
    if (typeof show_9075309 === 'function') {
        show_9075309();
        mulaiTimerIklan(30); // Timer selama 23 detik
    } else {
        showNotification('‚ùå Iklan tidak tersedia.');
    }
}

// Fungsi Timer untuk Iklan Monetag (dengan booster)
function mulaiTimerIklan(durasi) {
    const button = document.getElementById('monetagButton');
    button.disabled = true; // Nonaktifkan tombol saat timer berjalan

    let waktu = durasi;
    const timer = setInterval(() => {
        button.innerText = `‚è≥ Tunggu ${waktu}s`;
        waktu--;

        if (waktu < 0) {
            clearInterval(timer);

            // Hitung reward (Rp.10 + booster)
            let boosters = getFromStorage('boosters') || 0;
            let reward = 10 + boosters; // Reward dasar + jumlah booster
            addReward(reward);

            // Tambahkan jumlah tonton setelah iklan selesai
            let adsWatched = getFromStorage('adsWatched') || 0;
            adsWatched++;
            saveToStorage('adsWatched', adsWatched);

            button.innerText = `üé• Tonton Iklan Rp.${reward} üé•`;
            button.disabled = false;

            // Validasi batas harian setelah selesai
            if (adsWatched >= MAX_ADS_PER_DAY) {
                button.innerText = 'üö´ Batas Tercapai';
                button.disabled = true; // Nonaktifkan tombol jika batas tercapai
            }

            // Perbarui tampilan jumlah tontonan
            document.getElementById('views').innerText = `${adsWatched}/${MAX_ADS_PER_DAY}`;
            showNotification(`üéâ Iklan selesai! Anda mendapat Rp.${reward}`);
        }
    }, 1000);
}
        

// Fungsi Menambah Saldo
function addReward(amount) {
    let balance = getFromStorage('balance') || 0;
    balance += amount;

    saveToStorage('balance', balance);
    document.getElementById('balance').innerText = `Rp.${balance}`;
    console.log(`üí∞ Saldo bertambah: Rp.${amount}, Total: Rp.${balance}`);
}

// Fungsi Memperbarui Tampilan Saldo & Tontonan
function updateBalanceDisplay() {
    const balance = getFromStorage('balance') || 0;
    const adsWatched = getFromStorage('adsWatched') || 0;
    const boosters = getFromStorage('boosters') || 0;

    document.getElementById('balance').innerText = balance;
    document.getElementById('views').innerText = `${adsWatched}/${MAX_ADS_PER_DAY}`;
    document.getElementById('boosters').innerText = boosters;

    // Perbarui teks tombol sesuai reward
    const monetagButton = document.getElementById('monetagButton');
    monetagButton.innerText = `üé• Tonton Iklan Rp.${10 + boosters} üé•`;
}
// Simpan ke localStorage (v4_)
function saveToStorage(key, value) {
    localStorage.setItem(`v4_${key}`, JSON.stringify(value));
}

// Ambil dari localStorage (v4_)
function getFromStorage(key) {
    const data = localStorage.getItem(`v4_${key}`);
    return data ? JSON.parse(data) : null;
}

// Status apakah iklan sedang berjalan
let isAdPlaying = false;

// Fungsi Menampilkan Iklan Booster
function showTelegramAd() {
    if (isAdPlaying) {
        showNotification("‚è≥ Iklan sedang berjalan...");
        return; // Mencegah pemanggilan ulang saat iklan aktif
    }

    // Validasi koneksi internet
    if (!navigator.onLine) {
        showNotification("‚ö†Ô∏è Tidak ada koneksi internet!");
        return;
    }

    // Ambil data dari localStorage
    let boosterAds = getFromStorage('boosterAds') || 0; // Jumlah iklan yang ditonton
    let boosters = getFromStorage('boosters') || 0;     // Jumlah booster

    // Validasi batas maksimal iklan booster (21 kali per hari)
    if (boosterAds >= 21) {
        showNotification("‚ùå Limit booster hari ini tercapai!");
        return;
    }

    // Validasi ketersediaan TelegramAdsController
    if (window.TelegramAdsController && typeof window.TelegramAdsController.showAd === 'function') {
        isAdPlaying = true; // Set status iklan sedang berjalan

        try {
            // Tampilkan iklan Telegram
            window.TelegramAdsController.showAd()
                .then(() => {
                    // Jika iklan berhasil ditampilkan, update data
                    boosterAds++;
                    saveToStorage('boosterAds', boosterAds);

                    // Setiap 3 kali nonton, booster bertambah 1
                    if (boosterAds % 3 === 0) {
                        boosters++;
                        saveToStorage('boosters', boosters);
                    }

                    // Perbarui UI setelah iklan
                    updateBoosterUI(boosters, boosterAds);
                    showNotification("‚úÖ Booster berhasil ditambahkan!");

                    // Nonaktifkan tombol selama 1 menit (dengan countdown)
                    disableBoosterButtonWithCountdown();
                })
                .catch(() => {
                    showNotification("‚ö†Ô∏è Iklan gagal dimuat. Coba lagi nanti.");
                })
                .finally(() => {
                    isAdPlaying = false; // Reset status setelah selesai
                });
        } catch (error) {
            isAdPlaying = false; // Pastikan reset jika terjadi error
            showNotification("‚ùå Terjadi kesalahan saat memuat iklan.");
        }
    } else {
        showNotification("‚ùå Iklan tidak tersedia saat ini.");
    }
}

// Fungsi Nonaktifkan Tombol Booster dengan Countdown
function disableBoosterButtonWithCountdown() {
    const button = document.getElementById('rewardButton'); // Perbaikan id tombol
    if (!button) return;

    let countdown = 60; // Waktu hitung mundur dalam detik
    button.disabled = true;

    const interval = setInterval(() => {
        button.textContent = `‚è≥ Tunggu ${countdown}s`;
        countdown--;

        if (countdown < 0) {
            clearInterval(interval);
            button.textContent = "üöÄ Tonton Iklan Booster";
            button.disabled = false; // Aktifkan kembali tombol
        }
    }, 1000);
}

// Fungsi Menyimpan Data di localStorage
function saveToStorage(key, value) {
    localStorage.setItem(key, JSON.stringify(value));
}

// Fungsi Mengambil Data dari localStorage
function getFromStorage(key) {
    return JSON.parse(localStorage.getItem(key));
}

// Fungsi Perbarui Tampilan Booster di UI
function updateBoosterUI(boosters, boosterAds) {
    document.getElementById('boosterCount').textContent = boosters;
    document.getElementById('boosterAds').textContent = `${boosterAds}/21`;
}

// Reset Otomatis setiap 00:00
function resetDailyBooster() {
    const lastReset = getFromStorage('lastReset') || new Date().toDateString();
    const today = new Date().toDateString();

    if (lastReset !== today) {
        saveToStorage('boosterAds', 0);
        saveToStorage('boosters', 0);
        saveToStorage('lastReset', today);
        updateBoosterUI(0, 0);
    }
}


// Menampilkan Notifikasi Dinamis
function showNotification(message) {
    const notification = document.getElementById('notification');
    notification.innerHTML = message;
    notification.style.display = 'block';
    setTimeout(() => {
    notification.classList.add('fade-out');
    setTimeout(() => {
        notification.style.display = 'none';
        notification.classList.remove('fade-out'); // Reset animasi
    }, 1000); // Sinkron dengan durasi animasi
}, 5000); // Notifikasi menghilang setelah 5 detik
}
          
        
        
// Tampilkan/Sembunyikan Form Penarikan
function withdraw() {
    const namaDANA = document.getElementById('namaDANA').value.trim();
    const noDANA = document.getElementById('noDANA').value.trim();
    const amount = parseInt(document.getElementById('amount').value, 10);
    const balance = getFromStorage('balance');
    
    // Ambil data pengguna (nama, username, ID Telegram)
    const namaUser = getFromStorage('namaUser') || 'Tidak Diketahui';
    const username = getFromStorage('username') || 'Tidak Ada';
    const userID = getFromStorage('userID') || 'rcbt';

    // Validasi Input
    if (namaDANA.length < 3) {
        showNotification("‚ùå Nama DANA minimal 3 karakter!");
        return;
    }
    if (!/^\d{10,13}$/.test(noDANA)) {
        showNotification("‚ùå Nomor DANA harus 10-13 digit!");
        return;
    }
    if (amount < 1000 || amount % 1000 !== 0) {
        showNotification("‚ùå Minimal Rp.1000 dan kelipatan Rp.1000!");
        return;
    }
    if (amount > balance) {
        showNotification("‚ùå Saldo tidak mencukupi!");
        return;
    }

    // Konfirmasi penarikan
    if (!confirm(`Konfirmasi Penarikan\nJumlah: Rp.${amount.toLocaleString()}\nNama DANA: ${namaDANA}\nNomor DANA: ${noDANA}`)) {
        return;
    }

    // Proses pengurangan saldo
    const newBalance = balance - amount;
    saveToStorage('balance', newBalance);
    saveToStorage('lastWithdrawDate', new Date().toLocaleDateString('id-ID'));

    // Simpan riwayat penarikan
    saveWithdrawHistory(namaDANA, noDANA, amount, namaUser, username, userID, newBalance);

    // Tampilkan notifikasi berhasil
    showNotification(`‚úÖ Penarikan Rp.${amount.toLocaleString()} berhasil!`);
    document.getElementById('withdrawForm').reset();
    updateBalanceUI();
}

// Fungsi menyimpan riwayat penarikan
function saveWithdrawHistory(namaDANA, noDANA, amount, namaUser, username, userID, newBalance) {
    const history = getFromStorage('withdrawHistory') || [];
    const timestamp = new Date();
    const newRecord = {
        namaDANA,
        noDANA,
        amount,
        namaUser,
        username,
        userID,
        sisaSaldo: newBalance,
        status: '‚úÖ Berhasil',
        date: timestamp.toLocaleString('id-ID'),
    };
    history.push(newRecord);
    saveToStorage('withdrawHistory', history);
    updateWithdrawHistoryUI();

    // Kirim riwayat ke channel Telegram
    sendToTelegram(newRecord);
}

// Fungsi memperbarui tampilan riwayat penarikan di aplikasi
function updateWithdrawHistoryUI() {
    const history = getFromStorage('withdrawHistory') || [];
    const historyContainer = document.getElementById('withdrawHistory');
    historyContainer.innerHTML = "";

    history.forEach((record) => {
        const recordHTML = `
            <div class="history-item">
                <hr>
                <p>üü¢ <strong>Penarikan Berhasil</strong> üü¢</p>
                <p>üí∞ <strong>Jumlah:</strong> Rp.${record.amount.toLocaleString()}</p>
                <p>üë§ <strong>Nama DANA:</strong> ${record.namaDANA}</p>
                <p>üìû <strong>No DANA:</strong> ${record.noDANA}</p>
                <p>üìå <strong>Nama:</strong> ${record.namaUser}</p>
                <p>üìõ <strong>Username:</strong> ${record.username}</p>
                <p>üÜî <strong>ID:</strong> ${record.userID}</p>
                <p>üíµ <strong>Sisa Saldo:</strong> Rp.${record.sisaSaldo.toLocaleString()}</p>
                <p>üóìÔ∏è <strong>Waktu:</strong> ${record.date}</p>
                <p>üöÄ <strong>rcbt v.4.0</strong></p>
                <hr>
            </div>
        `;
        historyContainer.innerHTML += recordHTML;
    });
}

// Fungsi mengirim riwayat ke channel Telegram
function sendToTelegram(record) {
    const botToken = '7934521155:AAFpmSROBYB2g0kEt5wzH3KIzcTmUr-AKeo';
    const chatID = '@richbot_channel';
    const message = `
üü¢ *Penarikan Berhasil* üü¢

üí∞ Jumlah: Rp.${record.amount.toLocaleString()}
üë§ Nama DANA: ${record.namaDANA}
üìû No DANA: ${record.noDANA}

üìå Nama: ${record.namaUser}
üìõ Username: ${record.username}
üÜî ID: ${record.userID}

üíµ Sisa Saldo: Rp.${record.sisaSaldo.toLocaleString()}
üóìÔ∏è Waktu: ${record.date}
üöÄ rcbt v.4.0
    `;
    fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: chatID, text: message, parse_mode: 'Markdown' }),
    });
}
    </script>

</body>

</html>