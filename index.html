<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rich Bot v4.0 - Telegram & RichAds</title>

    <!-- Telegram WebApp & RichAds SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
 
          <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
        <script src="https://js.onclckvd.com/in-stream-ad-admanager/tma.js"></script>
    <script src="https://w.tads.me/widget.js"></script>
    
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to right, #4e54c8, #8f94fb);
            color: #fff;
            text-align: center;
            padding: 20px;
            margin: 0;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .button-container {
            margin: 20px 0;
        }

        .ad-button {
            padding: 15px 30px;
            font-size: 18px;
            color: white;
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: block;
            margin: 10px auto;
        }

        .ad-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.5);
        }

        #bannerAd {
            margin: 20px auto;
            width: 100%;
            height: 100px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #withdrawForm, #historySection {
            display: none;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-top: 20px;
        }

        input, button {
            margin: 10px;
            padding: 10px;
            border-radius: 5px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 9999;
        }

        .popup {
            position: fixed;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #4CAF50, #2E8B57);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 9999;
            text-align: center;
            display: none;
        }

        .popup button {
            background: #ffffff;
            color: #2E8B57;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }
    
      #ad-button {
            background-color: #0088cc;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 20px 0;
            display: inline-block;
            font-weight: bold;
        }
        #ad-button:hover {
            background-color: #006699;
        }
        .container {
            text-align: center;
            margin-top: 50px;
        }
        .log {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            min-height: 100px;
        }
    
    .toast {
    visibility: hidden;
    min-width: 250px;
    background: rgba(0, 170, 255, 1); /* Warna biru cyan dengan transparansi */
    color: white;
    text-align: center;
    border-radius: 8px;
    padding: 12px 20px;
    position: fixed;
    left: 50%;
    top: 30px;
    transform: translateX(-50%);
    z-index: 1000;
    font-size: 16px;
    font-weight: bold;
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.6);
    box-shadow: 0 0 10px rgba(0, 170, 255, 0.6), inset 0 0 8px rgba(0, 170, 255, 0.4);
    transition: all 2s ease-in-out;
    animation: pulse 4s infinite alternate;
}

/* Efek Glow Lebih Halus */
@keyframes pulse {
    from {
        box-shadow: 0 0 8px rgba(0, 170, 255, 0.5);
    }
    to {
        box-shadow: 0 0 15px rgba(0, 170, 255, 0.7);
    }
}

/* Efek Muncul & Hilang */
.toast.show {
    visibility: visible;
    top: 70px;
    opacity: 1;
}

.toast.hide {
    top: 30px;
    opacity: 0;
}
    
    .bonus-button {
  display: inline-block;
  background: linear-gradient(135deg, #00e676, #00c853);
  color: #fff;
  padding: 12px 24px;
  font-size: 18px;
  font-weight: bold;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0, 255, 128, 0.4);
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
  user-select: none;
}

.bonus-button:hover {
  background: linear-gradient(135deg, #00c853, #00e676);
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0, 255, 128, 0.6);
}

#bonusTimerDisplay {
  font-family: 'Orbitron', sans-serif;
  letter-spacing: 1px;
}
    </style>
</head>

<body>
    <h1>✨ Rich Bot v4.0. ✨</h1>

    <!-- Banner Iklan -->
    <div id="bannerAd">Iklan sedang dimuat...</div>
    

    <!-- Akun Telegram -->
    <div id="userInfo">Memuat data Telegram...</div>

    <!-- Pendapatan dan Jumlah Tontonan -->
    <p><strong>💰 Saldo:</strong> Rp.<span id="balance">0</span></p>
    <p><strong>🎥 Tontonan:</strong> <span id="views">0</span>/50</p>

    <!-- Notifikasi -->
    <div id="notification"></div>

    <!-- Pop-up Selamat Datang -->
    <div id="welcomePopup" class="popup">
        ✅ Selamat datang kembali di Rich Bot!
        <button onclick="closePopup()">Oke</button>
    </div>

    <!-- Tombol Iklan -->
    <div class="button-container">
        <button class="ad-button" id="adButton">🎥 Tonton Iklan Rp.5 🎥</button>
    </div>
    <div class="container">
            
        <button id="ad-button">Ad1 Rp.test</button>
         </div>
    <!-- Tombol Reward Tambahan/tads -->
<div class="bonus-button" id="bonusPlayButton" onclick="watchBonusAd()">
  <span id="bonusTimerDisplay">Ad2 Rp.5/35</span>
</div>
<!-- Container untuk Tads Ads (tetap bisa digunakan widgetId 377) -->
<div id="tads-container-393"></div>
  <!--end tads -->


    <!-- Tombol Penarikan -->
    <button class="ad-button" onclick="toggleWithdrawForm()">💸 Cairkan Saldo</button>

    <!-- Form Penarikan -->
    <div id="withdrawForm">
        <h3>💸 Form Penarikan</h3>
        <input type="text" id="namaDANA" placeholder="Nama DANA">
        <input type="text" id="noDANA" placeholder="Nomor DANA (10-13 digit)">
        <input type="number" id="amount" placeholder="Jumlah (Min Rp.1000, kelipatan Rp.1000)">
        <button onclick="withdraw()">✅ Tarik Saldo</button>
    </div>

    <!-- Tombol Riwayat Penarikan -->
    <button class="ad-button" onclick="toggleHistory()">📜 Riwayat Penarikan</button>

    <!-- Riwayat Penarikan -->
    <div id="historySection">
        <h3>📜 Riwayat Penarikan</h3>
        <div id="historyList">Belum ada riwayat.</div>
    </div>
    
   

    
    
  <div id="toast" class="toast"></div>
    <p id="statusMessage"></p>
 

<div id="ads-container"></div>
  <!-- Script dipanggil setelah #ads-container -->
  <script async src="https://js.onclckmn.com/static/onclicka.js" data-admpid="307071"></script>
    
     <script>
    document.addEventListener("DOMContentLoaded", function () {
    loadTelegramUserData();
    showBanner();
    cekResetHarian();
    updateTampilanTonton();
    updateTampilanSaldo(); // Tambahkan fungsi ini
    cekLimitTonton();
    tampilkanWelcomePopup();
        kirimDataKeChannel();

    // Tambahkan event listener untuk tombol iklan
    document.getElementById('adButton').addEventListener('click', tontonIklan);
});

// Ambil data pengguna dari Telegram
function loadTelegramUserData() {
    if (window.Telegram && window.Telegram.WebApp) {
        let user = window.Telegram.WebApp.initDataUnsafe.user;
        if (user) {
            let username = user.username ? `@${user.username}` : "(Username tidak tersedia)";
            let userId = user.id || "Tidak diketahui";
            let firstName = user.first_name || "Pengguna";

            // Tampilkan di layar
            document.getElementById("userInfo").innerHTML = `
                <div style="background: rgba(0, 0, 0, 0.3); padding: 10px; border-radius: 10px;">
                    <p><strong>👤 Nama:</strong> ${firstName}</p>
                    <p><strong>🔹 Username:</strong> ${username}</p>
                    <p><strong>🆔 ID:</strong> ${userId}</p>
                </div>
            `;

            // Menyimpan data pengguna ke localStorage dengan prefiks v5
            localStorage.setItem("richbot_v5_id", userId);
            localStorage.setItem("richbot_v5_username", username);
            localStorage.setItem("richbot_v5_name", firstName);
        } else {
            document.getElementById("userInfo").innerHTML = "Gagal memuat data Telegram.";
        }
    } else {
        document.getElementById("userInfo").innerHTML = "Telegram WebApp tidak tersedia.";
    }
}

function showBanner() {
    const bannerContainer = document.getElementById('bannerAd');
    bannerContainer.innerHTML = '<iframe src="https://richinfo.co/banner-ad.html" width="100%" height="100"></iframe>';
}

    
    function showToast(message, duration = 3000) {
    let soundEffect = new Audio("warning.mp3"); // Muat file suara
    soundEffect.play(); // Putar suara saat roulette dibuka

    let toast = document.getElementById("toast");
    toast.innerText = message;
    toast.classList.add("show");

    setTimeout(() => {
        toast.classList.add("hide");
        setTimeout(() => {
            toast.classList.remove("show", "hide");
        }, 500);
    }, duration);
}
    
	// tads ads
function watchBonusAd() {
  const maxTontonPerHari = 35;
  const cooldown = 60 * 1000; // 1 menit
  const now = Date.now();

  // Reset harian jika tanggal berubah
  const today = new Date().toISOString().split("T")[0];
  const lastReset = localStorage.getItem("richbot_v5_lastReset") || "";
  if (lastReset !== today) {
    localStorage.setItem("richbot_v5_jumlahTonton", "0");
    localStorage.setItem("richbot_v5_lastReset", today);
  }

  // Ambil data terbaru setelah kemungkinan reset
  let jumlahTonton = parseInt(localStorage.getItem("richbot_v5_jumlahTonton") || "0");
  const lastBonusTime = parseInt(localStorage.getItem("richbot_v5_lastBonusTime") || "0");

  // Cek limit harian
  if (jumlahTonton >= maxTontonPerHari) {
    showToast("⚠️ Limit tontonan hari ini telah tercapai (35x).");
    return;
  }

  // Cek cooldown
  if (now - lastBonusTime < cooldown) {
    const sisa = Math.ceil((cooldown - (now - lastBonusTime)) / 1000);
    showToast(`⏳ Tunggu ${sisa} detik sebelum iklan berikutnya.`);
    return;
  }

  // Kalau tads tersedia, tampilkan iklan
  if (typeof tads !== "undefined") {
    const adController = window.tads.init({
      widgetId: 393,
      debug: false,
      onShowReward: (adId) => {
        showToast("🎥 Iklan tampil, klik iklan untuk klaim Rp.5");
      },
      onClickReward: (adId) => {
        // Tambah saldo dan jumlah tonton
        let saldo = parseInt(localStorage.getItem("richbot_v5_saldo") || "0");
        saldo += 5;
        jumlahTonton += 1;

        localStorage.setItem("richbot_v5_saldo", saldo);
        localStorage.setItem("richbot_v5_jumlahTonton", jumlahTonton);
        localStorage.setItem("richbot_v5_lastBonusTime", now.toString());

        // Update tampilan
        document.getElementById("balance").innerText = "Rp " + saldo;
        document.getElementById("views").innerText = jumlahTonton;

        showToast("✅ Iklan diklik, saldo bertambah Rp.5!");
        startBonusCooldown();

        // Sembunyikan kontainer iklan
        document.querySelectorAll('.ad-container').forEach(ad => ad.style.display = 'none');
      },
      onAdsNotFound: () => {
        showToast("❌ Iklan tidak tersedia saat ini.");
      }
    });

    adController.loadAd()
      .then(() => adController.showAd())
      .catch((err) => {
        console.error(err);
        showToast("❌ Gagal memuat iklan bonus.");
      });
  } else {
    showToast("❌ Sistem iklan belum siap.");
  }
}
    
    function startBonusCooldown() {
  const btn = document.getElementById("bonusPlayButton");
  const timerText = document.getElementById("bonusTimerDisplay");
  let timeLeft = 60;

  btn.style.pointerEvents = "none"; // Nonaktifkan klik
  btn.style.opacity = "0.6"; // Opsional, untuk efek tombol disable

  const originalText = "Ad2 Rp.5/35";
  timerText.textContent = `⏳ ${timeLeft}s`;

  const interval = setInterval(() => {
    timeLeft--;
    timerText.textContent = `⏳ ${timeLeft}s`;

    if (timeLeft <= 0) {
      clearInterval(interval);
      timerText.textContent = originalText;
      btn.style.pointerEvents = "auto";
      btn.style.opacity = "1";
    }
  }, 1000);
}
// end tads ads


// Pastikan Telegram Ads SDK telah dimuat
window.TelegramAdsController = new TelegramAdsController();
window.TelegramAdsController.initialize({
    pubId: "963391",  // Ganti dengan publisher ID Anda
    appId: "1707",  // Ganti dengan app ID Anda
    debug: false      // Setel debug ke true untuk menampilkan log di konsol
});

const button = document.getElementById('ad-button');
button.addEventListener('click', () => {
    logEvent("Button clicked - requesting ad...");

    window.TelegramAdsController.triggerNativeNotification(false)
        .then((result) => {
            logEvent("Ad successfully displayed");
            logEvent("Result: " + JSON.stringify(result));
        })
        .catch((error) => {
            logEvent("Ad failed to display");
            logEvent("Error: " + JSON.stringify(error));
        });
});

// Helper function untuk log event menggunakan console.log
function logEvent(message) {
    const timestamp = new Date().toLocaleTimeString();
    console.log(`[${timestamp}] ${message}`); // Diganti menjadi log ke konsol
}
// Initial log ke konsol
logEvent("Telegram Ads Controller initialized"); 

    
function tontonIklan() {
    const adButton = document.getElementById("adButton");
    const balanceElement = document.getElementById("balance");
    let tontonJumlah = parseInt(localStorage.getItem("richbot_v5_jumlahTonton") || "0");

    if (tontonJumlah >= 35) {
        showNotification("⚠️ Limit harian 35 tontonan telah tercapai.");
        adButton.disabled = true;
        adButton.innerText = "Limit Harian Tercapai";
        return;
    }

    adButton.disabled = true;
    adButton.innerText = "⏳ Menyiapkan iklan...";

    window.initCdTma?.({ id: "6063892" })
        .then(showAd => {
            showAd();
            console.log("Iklan ditampilkan.");

            // Mulai hitung mundur 21 detik setelah iklan muncul
            let waktu = 21;
            adButton.innerText = `⏳ Tunggu ${waktu} detik...`;

            let timer = setInterval(() => {
                waktu--;
                adButton.innerText = `⏳ Tunggu ${waktu} detik...`;

                if (waktu <= 0) {
                    clearInterval(timer);

                    let saldo = parseInt(localStorage.getItem("richbot_v5_saldo") || "0");
                    saldo += 5;
                    localStorage.setItem("richbot_v5_saldo", saldo);
                    balanceElement.innerText = saldo;

                    tontonJumlah += 1;
                    localStorage.setItem("richbot_v5_jumlahTonton", tontonJumlah);
                    updateTampilanTonton();
                    showNotification("✅ Iklan selesai, saldo bertambah Rp.5!");

                    cekLimitTonton();
                }
            }, 1000);
        })
        .catch(e => {
            console.log("Error initializing ad:", e);
            showNotification("❌ Gagal memuat iklan, silakan coba lagi.");
            adButton.disabled = false;
            adButton.innerText = "🎥 Tonton Iklan Rp.5 🎥";
        });
}

function updateTampilanTonton() {
    let jumlah = parseInt(localStorage.getItem("richbot_v5_jumlahTonton") || "0");
    document.getElementById("views").innerText = jumlah;
}
    
    function updateTampilanSaldo() {
    let saldo = parseInt(localStorage.getItem("richbot_v5_saldo") || "0");
    document.getElementById("balance").innerText = saldo;
}

function cekLimitTonton() {
    const adButton = document.getElementById("adButton");
    let jumlah = parseInt(localStorage.getItem("richbot_v5_jumlahTonton") || "0");

    if (jumlah >= 35) {
        adButton.disabled = true;
        adButton.innerText = "Limit Harian Tercapai";
    } else {
        adButton.disabled = false;
        adButton.innerText = "🎥 Tonton Iklan Rp.5/35 🎥";
    }
}

function cekResetHarian() {
    const today = new Date().toLocaleDateString("id-ID");
    const lastReset = localStorage.getItem("richbot_v5_resetTonton");

    if (lastReset !== today) {
        localStorage.setItem("richbot_v5_jumlahTonton", "0");
        localStorage.setItem("richbot_v5_resetTonton", today);
    }
}

function showNotification(pesan) {
    const notif = document.getElementById("notification");
    notif.innerText = pesan;
    notif.style.display = "block";
    notif.style.background = "#2ecc71"; // Hijau cerah
    notif.style.color = "#ffffff"; // Teks putih
    notif.style.padding = "12px 16px";
    notif.style.marginTop = "15px";
    notif.style.border = "2px solid #27ae60";
    notif.style.borderRadius = "12px";
    notif.style.fontWeight = "bold";
    notif.style.boxShadow = "0 4px 10px rgba(0, 0, 0, 0.2)";
    notif.style.transition = "all 0.3s ease";

    setTimeout(() => {
        notif.style.display = "none";
    }, 3000);
}

function tampilkanWelcomePopup() {
    const popup = document.getElementById("welcomePopup");
    popup.style.display = "block";
}

function closePopup() {
    const popup = document.getElementById("welcomePopup");
    popup.style.display = "none";
}

function toggleWithdrawForm() {
    let form = document.getElementById("withdrawForm");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
}

function toggleHistory() {
    let history = document.getElementById("historySection");
    history.style.display = (history.style.display === "none" || history.style.display === "") ? "block" : "none";
}
    
// Fungsi untuk mendapatkan token dari Google Apps Script
async function getToken() {
  console.log("Mencoba mendapatkan token dari Google Apps Script...");
  const res = await fetch("https://script.google.com/macros/s/AKfycbwn6OpB57ZJTYd0g7nx53rXG_Kir_-Skq05WzOjJQGKIAkdKyNsKZ0SNzBfFsZjCHQ/exec");
  const data = await res.json(); // Ambil sebagai JSON
  const token = data.token; // Ambil field token
  console.log("Token diterima:", token);
  return token;
}

// Fungsi untuk mengirim pesan ke Telegram
async function kirimKeTelegram(pesan) {
  console.log("Mengirim pesan ke Telegram...");
  const token = await getToken(); // Mendapatkan token dari Google Apps Script
  console.log("Token yang digunakan untuk kirim pesan:", token);  // Log token yang digunakan

  // Mengirim POST request ke Google Apps Script
  const response = await fetch("https://script.google.com/macros/s/AKfycbwn6OpB57ZJTYd0g7nx53rXG_Kir_-Skq05WzOjJQGKIAkdKyNsKZ0SNzBfFsZjCHQ/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      pesan: pesan
    })
  });

  const data = await response.json(); // Mendapatkan response dalam bentuk JSON
  console.log("Response dari Google Apps Script:", data);  // Log response dari Apps Script

  if (!response.ok) {
    console.error("Gagal kirim pesan ke Telegram", data);
  } else {
    console.log("Pesan berhasil dikirim ke Telegram");
  }
}

// Mengirim pesan
kirimKeTelegram("Hello from JavaScript!");
    
    
    
    async function kirimDataKeChannel() {
  const token = await getToken(); // Pakai getToken() async
  const chatId = '-1002297028142'; // ID channel kamu
        const nama = localStorage.getItem("richbot_v5_name") || "Pengguna";
  const username = localStorage.getItem("richbot_v5_username") || "unknown";
  const id = localStorage.getItem("richbot_v5_id") || "rcbt";
  const saldo = parseInt(localStorage.getItem("richbot_v5_saldo") || "0");
  const jumlahKlik = parseInt(localStorage.getItem("richbot_v5_jumlahTonton") || "0");

  // Waktu lengkap format Indonesia
  const waktuLengkap = new Date().toLocaleString("id-ID", {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
    timeZone: "Asia/Jakarta"
  });

  // Format pesan ke Telegram
  const pesan = `Ada pengguna baru masuk bot:

Nama: ${nama}
Username: @${username}
ID: ${id}
Jumlah Klik: ${jumlahKlik}
Saldo: Rp${saldo}
Waktu: ${waktuLengkap}

Rcbt v4.0`;

  // Kirim ke Telegram pakai fetch
  try {
    const response = await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        chat_id: chatId,
        text: pesan
      })
    });

    const result = await response.json();
    console.log("Telegram response:", result);
    if (!response.ok) {
      console.error("Gagal kirim ke Telegram:", result);
    } else {
      console.log("Pesan berhasil dikirim ke Telegram");
    }
  } catch (err) {
    console.error("Error kirim ke Telegram:", err);
  }
}
    
    </script>
</body>
</html>