<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rich Bot - Telegram & RichAds</title>

    <!-- Telegram WebApp & RichAds SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
    <script src='//whephiwums.com/sdk.js' data-zone='9075309' data-sdk='show_9075309'></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to right, #4e54c8, #8f94fb);
            color: #fff;
            text-align: center;
            padding: 20px;
            margin: 0;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .button-container {
            margin: 20px 0;
        }

        .ad-button {
            padding: 15px 30px;
            font-size: 18px;
            color: white;
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;            
            display: block;
            margin: 10px auto;
        }

        .ad-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.5);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        #notification {
            margin-top: 20px;
            padding: 10px;
            display: none;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
    @keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

.fade-out {
    animation: fadeOut 1s forwards;
}

        #userInfo {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        #bannerAd {
    margin: 30px auto; /* Memberikan jarak 30px di bagian atas dan bawah, serta memusatkan banner secara horizontal */
    width: 100%; /* Membuat lebar banner sebesar 100% dari lebar parent container */
    height: 100px; /* Menentukan tinggi banner menjadi 250px */
    background: rgba(0, 0, 0, 0.2); /* Memberikan warna latar belakang hitam dengan transparansi 20% */
    border-radius: 10px; /* Membuat sudut banner menjadi membulat dengan radius 10px */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); /* Memberikan efek bayangan di sekitar banner (X: 0, Y: 4px, Blur: 8px, Transparansi: 40%) */
    display: flex; /* Mengatur banner menggunakan flexbox agar mudah dalam pengaturan isi (content) */
    align-items: center; /* Memusatkan konten secara vertikal di tengah banner */
    justify-content: center; /* Memusatkan konten secara horizontal di tengah banner */
}
    
     #withdrawForm, #historySection {
            display: none;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-top: 20px;
        }

        input, button {
            margin: 10px;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>

<body>

    <h1>âœ¨ Rich Bot v4.0 âœ¨</h1>
    

    <!-- Banner Ad (Embedded) -->
    <div id="bannerAd">Iklan sedang dimuat...</div>

    <div id="userInfo">Memuat data Telegram...</div>
    <div id="notification"></div>
     <p><strong>ğŸ’° Saldo:</strong> Rp.<span id="balance">0</span></p>
    <p><strong>ğŸ¥ Tontonan:</strong> <span id="views">0</span>/35</p>
    <p><strong>ğŸš€ Booster:</strong> <span id="boosters">0</span>/6</p>
</div>
<div id="notification"></div>

    <!-- Tombol Iklan Monetag (Tombol Baru di Atas) -->
    <div class="button-container">
        <button class="ad-button" id="monetagButton" onclick="tontonIklan()">ğŸ¥Tonton Iklan Rp.10ğŸ¥</button>
    </div>

    <!-- Tombol Iklan Telegram (Tombol Lama) -->
    <div class="button-container">
        <button class="ad-button" id="rewardButton" onclick="showTelegramAd()">ğŸš€boosterğŸš€</button>
    </div>


<button class="ad-button" onclick="toggleWithdrawForm()">ğŸ’¸ Cairkan Saldo</button>
<!-- Form Penarikan -->
    <div id="withdrawForm">
        <h3>ğŸ’¸ Form Penarikan</h3>
        <input type="text" id="namaDANA" placeholder="Nama DANA">
        <input type="text" id="noDANA" placeholder="Nomor DANA (10-13 digit)">
        <input type="number" id="amount" placeholder="Jumlah (Min Rp.1000, kelipatan Rp.1000)">
        <button onclick="withdraw()">âœ… Tarik Saldo</button>
    </div>
        <button class="ad-button" onclick="toggleHistory()">ğŸ“œ Riwayat Penarikan</button>
    </div>

    

    <!-- Riwayat Penarikan -->
    <div id="historySection">
        <h3>ğŸ“œ Riwayat Penarikan</h3>
        <div id="historyList">Belum ada riwayat.</div>
    <!-- Notifikasi -->
    

    <script>
               
// Jalankan Saat Halaman Dimuat
window.addEventListener('DOMContentLoaded',async() => {
    console.log('Isi localStorage:', localStorage);
    initTelegramWebApp();
    validateUser();   
     resetDaily();
    loadUserData();
    showBanner();
    updateBoosterCount(getFromStorage('boosters') || 0);
    // Klik tombol Booster untuk menampilkan iklan
    const boosterButton = document.getElementById('rewardButton');
boosterButton.addEventListener('click', showTelegramAd);
    const balance = getFromStorage('balance') || 0;
    const adsWatched = getFromStorage('adsWatched') || 0;
    document.getElementById('boosters').innerText = `${getFromStorage('boosters') || 0}/3`;
});
    
        
        // Fungsi Penyimpanan dengan Prefix v4_
function saveToStorage(key, value) {
    localStorage.setItem(`v4_${key}`, JSON.stringify(value));
    console.log(`âœ… Disimpan: v4_${key} =`, value);
}

function getFromStorage(key) {
    const data = localStorage.getItem(`v4_${key}`);
    console.log(`ğŸ“¤ Diambil: v4_${key} =`, data);
    return data ? JSON.parse(data) : 0;  // Pastikan default 0 jika tidak ada data
}
                // Reset Otomatis di Pukul 00:00
    function resetDaily() {
        const lastReset = getFromStorage('lastReset');
        const today = new Date().toLocaleDateString();

        if (lastReset !== today) {
            saveToStorage('adsWatched', 0);  // Reset jumlah iklan Monetag
            saveToStorage('boosters', 0);    // Reset booster Telegram
            saveToStorage('lastReset', today); // Perbarui tanggal terakhir reset
            console.log('ğŸ”„ Data telah di-reset otomatis.');
        }
    }
       // Inisialisasi Telegram WebApp
let telegramUser = {};

function initTelegramWebApp() {
    if (window.Telegram && Telegram.WebApp) {
        try {
            Telegram.WebApp.ready();
            const user = Telegram.WebApp.initDataUnsafe?.user;

            if (user) {
                telegramUser = user;
                saveToStorage('user', user); // Simpan dengan prefix v4_
                displayUserInfo(user);
                console.log("âœ… Data Pengguna:", user);
            } else {
                showNotification("âŒ Gagal memuat data Telegram.");
            }
        } catch (error) {
            console.error("âŒ Error mengambil data Telegram:", error);
            showNotification("âŒ Terjadi kesalahan saat memuat data.");
        }
    } else {
        showNotification("âŒ Telegram WebApp tidak tersedia.");
    }
}

// Tampilkan Info Pengguna Telegram
function displayUserInfo(user) {
    const userInfo = document.getElementById('userInfo');
    userInfo.innerHTML = `
        <p><strong>ğŸ‘¤ Nama:</strong> ${user.first_name || 'Tidak ada'}</p>
        <p><strong>ğŸ“› Username:</strong> ${user.username || 'Tidak ada'}</p>
        <p><strong>ğŸ†” ID:</strong> ${user.id || 'Tidak ada'}</p>
    `;
}

// Fungsi Membuat Fingerprint Unik (User Agent + Platform + Resolusi + Bahasa)
function getDeviceFingerprint() {
    return `${navigator.userAgent}-${navigator.platform}-${screen.width}x${screen.height}-${navigator.language}`;
}

// Cek Apakah Diakses dari Telegram WebApp
function isTelegramWebApp() {
    return window.Telegram && Telegram.WebApp && Telegram.WebApp.initData;
}

// Validasi Pengguna Telegram, IP, dan Device
async function validateUser() {
    try {
        // Pastikan Hanya Bisa Diakses dari Telegram
        if (!isTelegramWebApp()) {
            alert('ğŸš« Hanya bisa diakses melalui Telegram!');
            document.body.innerHTML = '<h2>ğŸš« Akses dibatasi, buka di Telegram!</h2>';
            return;
        }

        const user = Telegram.WebApp.initDataUnsafe?.user;
        if (!user) {
            alert('ğŸš« Bot terdeteksi, akses diblokir!');
            document.body.innerHTML = '<h2>ğŸš« Bot Tidak Diizinkan</h2>';
            return;
        }
        const userId = user.id;

        // Ambil IP Publik (Fallback ke 127.0.0.1 jika gagal)
        const ipResponse = await fetch('https://api.ipify.org?format=json').catch(() => null);
        const ip = ipResponse ? (await ipResponse.json()).ip : '127.0.0.1';

        // Ambil Fingerprint Perangkat
        const deviceFingerprint = getDeviceFingerprint();
        console.log(`ğŸ“² Fingerprint: ${deviceFingerprint}`);

        // Ambil Data Validasi Sebelumnya dari localStorage dan sessionStorage
        const registeredData = JSON.parse(localStorage.getItem('registeredData')) || [];
        const sessionData = JSON.parse(sessionStorage.getItem('sessionData')) || null;

        // Cek Apakah ID + Device Sudah Terdaftar Sebelumnya
        const isRegistered = registeredData.some(entry =>
            entry.userId === userId && entry.device === deviceFingerprint
        );

        // Jika Ada di sessionStorage (Cegah Refresh atau Restart)
        if (sessionData && sessionData.userId === userId && sessionData.device === deviceFingerprint) {
            alert('âœ… Selamat datang kembali di Rich Bot!');
            console.log('âœ… Sesi aktif, validasi lewat.');
            return;
        }

        // Validasi Ketat: Cegah Akun, Perangkat, atau IP Ganda
        const isUserIdUsed = registeredData.some(entry => entry.userId === userId);
        const isDeviceUsed = registeredData.some(entry => entry.device === deviceFingerprint);
        const devicesPerIP = registeredData.filter(entry => entry.ip === ip).length;

        if (isUserIdUsed) {
            alert('ğŸš« Akses ditolak: Akun sudah digunakan di perangkat lain.');
            document.body.innerHTML = '<h2>ğŸš« Akses Diblokir</h2>';
        } else if (isDeviceUsed) {
            alert('ğŸš« Akses ditolak: Perangkat ini sudah digunakan dengan akun lain.');
            document.body.innerHTML = '<h2>ğŸš« Perangkat Tidak Diizinkan</h2>';
        } else if (devicesPerIP >= 1) {
            alert('ğŸš« Akses dibatasi: Hanya 1 perangkat yang diizinkan di jaringan ini.');
            document.body.innerHTML = '<h2>ğŸš« Batas Perangkat Tercapai</h2>';
        } else {
            // Simpan Data Baru (ID + IP + Device)
            registeredData.push({ userId, ip, device: deviceFingerprint });
            localStorage.setItem('registeredData', JSON.stringify(registeredData));

            // Simpan di sessionStorage (Agar Bertahan di Sesi Ini)
            sessionStorage.setItem('sessionData', JSON.stringify({ userId, ip, device: deviceFingerprint }));

            alert('âœ… Selamat datang di Rich Bot!');
        }
    } catch (error) {
        console.error('âŒ Error validasi pengguna:', error);
        alert('âŒ Gagal memverifikasi pengguna.');
    }
}



// Inisialisasi Telegram Ads
window.TelegramAdsController = new TelegramAdsController();
window.TelegramAdsController.initialize({
    pubId: "963391",
    appId: "1707"
});
        // Menampilkan Embedded Banner
function showBanner() {
    const bannerContainer = document.getElementById('bannerAd');

    if (window.TelegramAdsController) {
        window.TelegramAdsController.showBanner(bannerContainer, {
            onLoad: function() {
                bannerContainer.innerHTML = ''; // Bersihkan teks loading
            },
            onError: function() {
                bannerContainer.innerHTML = 'âŒ Gagal memuat banner.';
            }
        });
    } else {
        bannerContainer.innerHTML = 'âŒ Banner tidak tersedia.';
    }
}
       
// Maksimal tontonan iklan Monetag per hari
const MAX_ADS_PER_DAY = 35;

// Fungsi untuk menonton iklan Monetag
function tontonIklan() {
    let adsWatched = getFromStorage('adsWatched') || 0;

    // Validasi batas harian
    if (adsWatched >= MAX_ADS_PER_DAY) {
        showNotification('ğŸš« Batas tonton iklan harian tercapai.');
        const button = document.getElementById('monetagButton');
        button.innerText = 'ğŸš« Batas Tercapai';
        button.disabled = true; // Nonaktifkan tombol jika batas tercapai
        return;
    }

    // Tampilkan iklan Monetag jika tersedia
    if (typeof show_9075309 === 'function') {
        show_9075309();
        mulaiTimerIklan(30); // Timer selama 23 detik
    } else {
        showNotification('âŒ Iklan tidak tersedia.');
    }
}

// Fungsi Timer untuk Iklan Monetag
function mulaiTimerIklan(durasi) {
    const button = document.getElementById('monetagButton');
    button.disabled = true; // Nonaktifkan tombol saat timer berjalan

    let waktu = durasi;
    const timer = setInterval(() => {
        button.innerText = `â³ Tunggu ${waktu}s`;
        waktu--;

        if (waktu < 0) {
            clearInterval(timer);
            addReward(10); // Tambah saldo Rp.10 setelah iklan selesai

            // Tambahkan jumlah tonton setelah iklan selesai
            let adsWatched = getFromStorage('adsWatched') || 0;
            adsWatched++;
            saveToStorage('adsWatched', adsWatched);

            button.innerText = 'ğŸ¥Tonton Iklan Rp.10ğŸ¥';
            button.disabled = false;

            // Validasi batas harian setelah selesai
            if (adsWatched >= MAX_ADS_PER_DAY) {
                button.innerText = 'ğŸš« Batas Tercapai';
                button.disabled = true; // Nonaktifkan tombol jika batas tercapai
            }

            // Perbarui tampilan jumlah tontonan
            document.getElementById('views').innerText = `${adsWatched}/35`;
            showNotification('ğŸ‰ Iklan selesai! Anda mendapat Rp.10');
        }
    }, 1000);
}
        // Fungsi untuk menambah saldo
function addReward(amount) {
    let balance = getFromStorage('balance') || 0;
    balance += amount;
    saveToStorage('balance', balance);
    document.getElementById('balance').innerText = balance;
    updateBalanceDisplay();
}

// Fungsi Memperbarui Tampilan Saldo & Tontonan
function updateBalanceDisplay() {
    const balance = getFromStorage('balance') || 0;
    const adsWatched = getFromStorage('adsWatched') || 0;
    const boosters = getFromStorage('boosters') || 0;

    document.getElementById('balance').innerText = balance;
    document.getElementById('views').innerText = adsWatched;
    document.getElementById('boosters').innerText = boosters;
}

// Simpan ke localStorage (v4_)
function saveToStorage(key, value) {
    localStorage.setItem(`v4_${key}`, JSON.stringify(value));
}

// Ambil dari localStorage (v4_)
function getFromStorage(key) {
    const data = localStorage.getItem(`v4_${key}`);
    return data ? JSON.parse(data) : null;
}

// Fungsi untuk memanggil iklan Telegram Booster
function showTelegramAd() {
    let boosters = getFromStorage('boosters') || 0;
    let adCount = getFromStorage('adCount') || 0;

    // Batas booster maksimal 3 per hari
    if (boosters >= 6) {
        showNotification('ğŸš€ Booster harian telah tercapai.');
        return;
    }

    if (window.TelegramAdsController) {
        window.TelegramAdsController.showAd({
            onClose: function() {
                showNotification('âœ… Terima kasih! Booster Anda bertambah.');
                addReward(2);
                
                // Tambah jumlah tontonan iklan
                adCount++;
                saveToStorage('adCount', adCount);

                // Tambah booster setelah menonton 5 iklan
                if (adCount % 5 === 0) {
                    boosters += 2; // Tambah 2 booster setiap 5 iklan
                    showNotification('ğŸ‰ Bonus! Anda mendapat 2 Booster tambahan.');
                } else {
                    boosters++;
                }

                saveToStorage('boosters', boosters);
                updateBoosterCount(boosters);
            },
            onError: function() {
                showNotification('âŒ Iklan gagal dimuat. Coba lagi nanti.');
            }
        });
    } else {
        showNotification('â³ Iklan Telegram sedang dimuat. Silakan coba lagi.');
    }
}
        function updateBoosterCount(boosters) {
    document.getElementById('boosters').innerText = `${boosters}/3`;
}

// Tambahkan Reward ke Saldo (Dengan Penyimpanan v4_)
function addReward(amount) {
    const currentBalance = getFromStorage('balance') || 0;
    const newBalance = currentBalance + amount;
    saveToStorage('balance', newBalance);
    document.getElementById('balance').innerText = newBalance;
    showNotification(`âœ… Anda mendapatkan Rp.${amount}!`);
}
        
        function loadUserData() {
    const balance = getFromStorage('balance') || 0;
    const adsWatched = getFromStorage('adsWatched') || 0;
    const boosters = getFromStorage('boosters') || 0;

    console.log(`ğŸ’° Saldo: ${balance}, ğŸ“º Tontonan: ${adsWatched}, ğŸš€ Booster: ${boosters}`);
    
    // Tampilkan di UI
    document.getElementById('balance').textContent = balance;
    document.getElementById('views').textContent = adsWatched;
    document.getElementById('boosters').textContent = boosters;
}

// Menampilkan Notifikasi Dinamis
function showNotification(message) {
    const notification = document.getElementById('notification');
    notification.innerHTML = message;
    notification.style.display = 'block';
    setTimeout(() => {
    notification.classList.add('fade-out');
    setTimeout(() => {
        notification.style.display = 'none';
        notification.classList.remove('fade-out'); // Reset animasi
    }, 1000); // Sinkron dengan durasi animasi
}, 5000); // Notifikasi menghilang setelah 5 detik
}
        
        
// Tampilkan/Sembunyikan Form Penarikan
function toggleWithdrawForm() {
    const form = document.getElementById('withdrawForm');
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
}

// Tampilkan/Sembunyikan Riwayat Penarikan
function toggleHistory() {
    const history = document.getElementById('historySection');
    history.style.display = history.style.display === 'none' ? 'block' : 'none';
}
    </script>

</body>

</html>